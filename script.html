<<<<<<< HEAD:script.html
<script>/* Scoped REM for .eventscarouselwrapper */function updateScopedRem(){
  const wrapper = document.querySelector(".eventscarouselwrapper");
  const modal = document.querySelector(".eventsmodalwindowswrapper");
  if(!wrapper) return;
  let rem;
  if(window.innerWidth < 600) {
    // На мобильных: 0.75em = 12px, значит 1em = 16px
    rem = 16;
    wrapper.style.fontSize = rem + "px";
    if (modal) modal.style.fontSize = rem + "px";
  } else {
    rem = window.innerWidth/1920*19.05;
    rem = Math.max(rem, 12); // не меньше 12px на десктопе
    wrapper.style.fontSize = rem + "px";
    if (modal) modal.style.fontSize = rem + "px";
  }
}
window.addEventListener("DOMContentLoaded",updateScopedRem);
window.addEventListener("resize",updateScopedRem);</script>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>

/* Main carousel initialize */

const swiperEvents = new Swiper('.swiper.swiper-events', {
  loop: false,
  slidesOffsetBefore: 32,
  slidesOffsetAfter: 32,
  slidesPerView: 'auto',
  navigation: {
    nextEl: '.events-button-next',
    prevEl: '.events-button-prev'
  }
});

</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const SLIDE_DURATION = 5000;
  const eventSlides = Array.from(document.querySelectorAll('.swiper-slide.events'));
  const modal = document.querySelector('.eventsmodalwindowswrapper');
  const storiesWrapper = modal.querySelector('.storieswrapper .swiper-wrapper.stories');
  const storySlides = Array.from(storiesWrapper.querySelectorAll('.swiper-slide.story-slide'));
  const btnPrev = modal.querySelector('.inner-prev');
  const btnNext = modal.querySelector('.inner-next');
  const paginationWrapper = modal.querySelector('.pagination');
  const btnClose = modal.querySelector('.closemodal');
  const navWrapper = modal.querySelector('.eventsmodalnavigation');

  // Убедимся что модальное окно изначально скрыто
  modal.style.display = 'none';

  let currentStoryIndex = 0;
  let currentInnerIndex = 0;
  let autoProgressTimeout;
  let progressStartTime = 0;
  let progressRemaining = SLIDE_DURATION;
  let isPaused = false;

  Object.assign(navWrapper.style, {
    position: 'absolute',
    left: '50%',
    transform: 'translateX(-50%)',
    transition: 'opacity 0.5s ease, pointer-events 0.5s ease',
    pointerEvents: 'auto'
  });

  function resetStyles() {
    clearTimeout(autoProgressTimeout);
    storiesWrapper.style.transition = 'none';
    storiesWrapper.style.transform = 'translateX(0)';
    storySlides.forEach(s => {
      s.style.width = '';
      const inner = s.querySelector('.inner-swiper .swiper-wrapper');
      if (inner) {
        inner.style.transition = 'none';
        inner.style.transform = 'translateX(0)';
      }
    });
  }

  function openStory(idx) {
    currentStoryIndex = idx;
    currentInnerIndex = 0;
    resetStyles();
    modal.style.display = 'flex';
    navWrapper.style.opacity = '1';
    updateSlidesStyle();
    requestAnimationFrame(() => requestAnimationFrame(centerStory));
  }

  // Обработчик для прямых кликов по слайдам событий
  eventSlides.forEach((slide, idx) => {
    slide.addEventListener('click', e => {
      // Проверяем, был ли клик по eventid-out
      const eventIdOutElement = e.target.closest('[eventid-out], .eventid-out');
      if (eventIdOutElement && !eventIdOutElement.classList.contains('w-dyn-bind-empty')) {
        const eventId = eventIdOutElement.getAttribute('eventid-out') || eventIdOutElement.dataset.eventidOut;
        if (eventId) {
          // Ищем соответствующую историю с eventid-in
          const matchIndex = storySlides.findIndex(story => {
            const inId = story.getAttribute('eventid-in') || story.dataset.eventidIn;
            return inId === eventId && !story.querySelector('.eventid-in').classList.contains('w-dyn-bind-empty');
          });
          if (matchIndex !== -1) {
            e.preventDefault();
            e.stopPropagation();
            openStory(matchIndex);
            return;
          }
        }
      }
      // Если не нашли eventid-out или не нашли соответствующий eventid-in, открываем историю по индексу слайда
      openStory(idx);
    });
  });

  function updateSlidesStyle() {
    storySlides.forEach((s, idx) => {
      const overlay = s.querySelector('.stories-overlay');
      if (overlay) {
        Object.assign(overlay.style, {
          position: 'absolute',
          top: '0',
          left: '0',
          width: '100%',
          height: '100%',
          pointerEvents: 'none',
          transition: 'opacity 0.5s ease',
          display: idx === currentStoryIndex ? 'none' : 'block',
          opacity: idx === currentStoryIndex ? '0' : '1'
        });
      }
      // Добавляем cursor: pointer для неактивных историй
      s.style.cursor = idx === currentStoryIndex ? '' : 'pointer';
      // Сохраняем естественную ширину слайдов для корректного центрирования
      s.style.transition = '';
      s.style.width = '';
    });
  }

  function centerStory() {
    const containerWidth = storiesWrapper.parentElement.clientWidth;
    const active = storySlides[currentStoryIndex];
    const shift = containerWidth / 2 - (active.offsetLeft + active.offsetWidth / 2);

    storiesWrapper.style.transition = 'transform 0.5s ease';
    storiesWrapper.style.transform = `translateX(${shift}px)`;

    updateInnerSlide();
  }

  function updateInnerSlide() {
    clearTimeout(autoProgressTimeout);
    const story = storySlides[currentStoryIndex];
    const innerWrapper = story.querySelector('.inner-swiper .swiper-wrapper');
    const innerSlides = Array.from(innerWrapper.querySelectorAll('.inner-slide'));
    if (currentInnerIndex >= innerSlides.length) currentInnerIndex = 0;

    storySlides.forEach((storySlide, idx) => {
      const wrapper = storySlide.querySelector('.inner-swiper .swiper-wrapper');
      if (wrapper && idx !== currentStoryIndex) {
        wrapper.style.transition = 'none';
        wrapper.style.transform = 'translateX(0)';
      }
    });

    const w = innerSlides[0]?.offsetWidth || 0;
    innerWrapper.style.transition = 'none';
    innerWrapper.style.transform = `translateX(-${currentInnerIndex * w}px)`;
    innerWrapper.offsetHeight;
    innerWrapper.style.transition = 'transform 0.5s ease';

    btnPrev.classList.toggle('swiper-button-disabled', currentStoryIndex === 0 && currentInnerIndex === 0);
    btnNext.classList.toggle('swiper-button-disabled',
      currentStoryIndex === storySlides.length - 1 &&
      currentInnerIndex === innerSlides.length - 1
    );

    paginationWrapper.innerHTML = '';
    innerSlides.forEach((_, i) => {
      const bullet = document.createElement('div');
      bullet.className = 'pagination-bullet';
      bullet.style.borderRadius = '0.25em';
      const prog = document.createElement('div');
      prog.className = 'progress-bar';
      prog.style.borderRadius = '0.25em';
      prog.style.width = i < currentInnerIndex ? '100%' : '0%';
      prog.style.transition = 'none';
      bullet.appendChild(prog);
      bullet.addEventListener('click', () => {
        clearTimeout(autoProgressTimeout);
        currentInnerIndex = i;
        updateInnerSlide();
=======
// Stories Modal System
class StoriesModal {
  constructor() {
    this.modal = document.querySelector('.eventsmodalwindowswrapper');
    this.storiesWrapper = document.querySelector('.storieswrapper');
    this.storiesContainer = document.querySelector('.swiper-wrapper.stories');
    this.pagination = document.querySelector('.pagination');
    this.closeBtn = document.querySelector('.closemodal');
    this.prevBtn = document.querySelector('.inner-prev');
    this.nextBtn = document.querySelector('.inner-next');
    this.navigation = document.querySelector('.eventsmodalnavigation');
    
    this.currentStoryIndex = 0;
    this.currentPhotoIndex = 0;
    this.stories = [];
    this.autoProgressTimer = null;
    this.progressAnimationTimer = null;
    this.isMobile = window.innerWidth <= 479;
    this.isPaused = false;
    this.pauseStartTime = 0;
    this.progressStartTime = 0;
    
    this.init();
  }

  init() {
    this.collectStories();
    this.bindEvents();
    this.setupResponsive();
  }

  collectStories() {
    const storySlides = document.querySelectorAll('.swiper-slide.story-slide');
    this.stories = Array.from(storySlides).map((slide, index) => {
      const eventId = slide.querySelector('.eventid-in')?.textContent?.trim();
      const photos = Array.from(slide.querySelectorAll('.swiper-slide.inner-slide'));
      return {
        element: slide,
        eventId,
        photos,
        index
      };
    });
  }

  bindEvents() {
    // Открытие модального окна
    document.querySelectorAll('.swiper-slide.events').forEach(eventSlide => {
      eventSlide.addEventListener('click', (e) => {
        const eventId = eventSlide.querySelector('.eventid-out')?.textContent?.trim();
        console.log('Clicked event ID:', eventId); // Для отладки
        this.openModal(eventId);
>>>>>>> 785b7cd25916d839f8d89c7138878ce9b743396b:script.js
      });
    });

    // Закрытие модального окна
    this.closeBtn?.addEventListener('click', () => this.closeModal());

    // Навигация
    this.prevBtn?.addEventListener('click', () => this.navigatePrev());
    this.nextBtn?.addEventListener('click', () => this.navigateNext());

    // Responsive
    window.addEventListener('resize', () => this.setupResponsive());

    // Swipe для мобильных
    this.setupSwipeGestures();

    // Пауза при удержании
    this.setupPauseGestures();
  }

<<<<<<< HEAD:script.html
  function pauseProgress() {
    if (!isPaused) {
      clearTimeout(autoProgressTimeout);
      const elapsed = Date.now() - progressStartTime;
      progressRemaining = Math.max(0, SLIDE_DURATION - elapsed);
      
      const activeProg = paginationWrapper.children[currentInnerIndex]?.querySelector('.progress-bar');
      if (activeProg) {
        activeProg.style.transition = 'none';
        activeProg.style.width = `${(elapsed / SLIDE_DURATION) * 100}%`;
      }
      navWrapper.style.pointerEvents = 'none';
      navWrapper.style.opacity = '0';
      isPaused = true;
    }
  }

  function resumeProgress() {
    if (isPaused) {
      const activeProg = paginationWrapper.children[currentInnerIndex]?.querySelector('.progress-bar');
      if (activeProg) {
        activeProg.style.transition = `width ${progressRemaining}ms linear`;
        activeProg.offsetHeight; // Force reflow
        activeProg.style.width = '100%';
      }
      progressStartTime = Date.now();
      autoProgressTimeout = setTimeout(goNext, progressRemaining);
      navWrapper.style.opacity = '1';
      navWrapper.style.pointerEvents = 'auto';
      isPaused = false;
    }
  }

  let startX = 0;
  let isNavigationInteraction = false;

  // Функция для проверки, является ли элемент частью навигации
  function isNavigationElement(element) {
    return element.closest('.inner-prev') ||
           element.closest('.inner-next') ||
           element.closest('.pagination-bullet') ||
           element.closest('.closemodal');
  }

  // Обработчики для navWrapper
  navWrapper.addEventListener('pointerdown', e => {
    if (!isNavigationElement(e.target)) {
      pauseProgress();
    }
    isNavigationInteraction = isNavigationElement(e.target);
  });

  navWrapper.addEventListener('pointerup', e => {
    if (!isNavigationElement(e.target) && !isNavigationInteraction) {
      resumeProgress();
    }
    isNavigationInteraction = false;
  });

  // Обработчики для storiesWrapper
  storiesWrapper.addEventListener('click', e => {
    const clickedSlide = e.target.closest('.swiper-slide.story-slide');
    if (clickedSlide && !clickedSlide.contains(storySlides[currentStoryIndex])) {
      const newIndex = storySlides.indexOf(clickedSlide);
      if (newIndex !== -1) {
        currentStoryIndex = newIndex;
        currentInnerIndex = 0;
        updateSlidesStyle();
        centerStory();
      }
    }
  });

  let isActiveStoryInteraction = false;
  let isPointerDown = false;

  storiesWrapper.addEventListener('pointerdown', e => {
    const activeStory = storySlides[currentStoryIndex];
    const isClickOnActive = activeStory.contains(e.target);
    
    if (isClickOnActive) {
      isActiveStoryInteraction = true;
      isPointerDown = true;
      startX = e.clientX;
      pauseProgress();
      document.addEventListener('pointermove', handlePointerMove);
    }
  });

  function handlePointerMove(e) {
    if (!isPointerDown) return;
  }

  function handleGlobalPointerUp(e) {
    if (!isPointerDown) return;

    document.removeEventListener('pointermove', handlePointerMove);

    const diff = e.clientX - startX;
    const activeStory = storySlides[currentStoryIndex];

    if (isActiveStoryInteraction) {
      if (Math.abs(diff) > 40) {
        diff < 0 ? goNext() : goPrev();
      } else if (activeStory.contains(e.target)) {
        openActiveLink();
      }
    }

    // ✅ ВСЕГДА возобновляем
    resumeProgress();

    isPointerDown = false;
    isActiveStoryInteraction = false;
  }

  function handlePointerCancel() {
    if (isPointerDown) {
      isPointerDown = false;
      isActiveStoryInteraction = false;
      resumeProgress();
    }
  }

  // Слушаем глобально
  document.addEventListener('pointerup', handleGlobalPointerUp);
  document.addEventListener('pointercancel', handlePointerCancel);
=======
  setupSwipeGestures() {
    if (!this.isMobile) return;

    let startX = 0;
    let startY = 0;
    let isSwipe = false;

    this.modal.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      isSwipe = false;
    });

    this.modal.addEventListener('touchmove', (e) => {
      if (!startX || !startY) return;

      const diffX = Math.abs(e.touches[0].clientX - startX);
      const diffY = Math.abs(e.touches[0].clientY - startY);

      if (diffX > diffY && diffX > 50) {
        isSwipe = true;
        e.preventDefault();
      }
    });

    this.modal.addEventListener('touchend', (e) => {
      if (!isSwipe || !startX) return;

      const endX = e.changedTouches[0].clientX;
      const diffX = startX - endX;

      if (Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // Swipe left - следующая история
          this.navigateToStory(this.currentStoryIndex + 1);
        } else {
          // Swipe right - предыдущая история
          this.navigateToStory(this.currentStoryIndex - 1);
        }
      }

      startX = 0;
      startY = 0;
      isSwipe = false;
    });
  }

  setupPauseGestures() {
    // Для мыши
    this.modal.addEventListener('mousedown', (e) => {
      // Проверяем, что клик не по кнопкам навигации
      if (e.target.closest('.eventsmodalnavigation')) return;
      this.pauseProgress();
    });

    document.addEventListener('mouseup', () => {
      if (this.isPaused) {
        this.resumeProgress();
      }
    });

    // Для тач-устройств
    this.modal.addEventListener('touchstart', (e) => {
      // Проверяем, что тач не по кнопкам навигации
      if (e.target.closest('.eventsmodalnavigation')) return;
      this.pauseProgress();
    });

    document.addEventListener('touchend', () => {
      if (this.isPaused) {
        this.resumeProgress();
      }
    });
  }

  pauseProgress() {
    if (this.isPaused) return;
    
    this.isPaused = true;
    this.pauseStartTime = Date.now();
    
    // Останавливаем автопрогресс
    this.stopAutoProgress();
    
    // Скрываем навигацию
    if (this.navigation) {
      this.navigation.style.opacity = '0';
      this.navigation.style.transition = 'opacity 300ms ease';
    }
    
    // Останавливаем анимацию progress-bar
    const currentBullet = this.pagination.children[this.currentPhotoIndex];
    if (currentBullet) {
      const progressBar = currentBullet.querySelector('.progress-bar');
      const computedStyle = window.getComputedStyle(progressBar);
      const currentWidth = computedStyle.width;
      progressBar.style.width = currentWidth;
      progressBar.style.transition = 'none';
    }
  }

  resumeProgress() {
    if (!this.isPaused) return;
    
    this.isPaused = false;
    
    // Показываем навигацию
    if (this.navigation) {
      this.navigation.style.opacity = '1';
    }
    
    // Вычисляем оставшееся время
    const pauseDuration = Date.now() - this.pauseStartTime;
    const elapsed = Date.now() - this.progressStartTime;
    const remaining = Math.max(0, 5000 - elapsed);
    
    // Возобновляем прогресс
    this.startAutoProgress(remaining);
    
    // Возобновляем анимацию progress-bar
    const currentBullet = this.pagination.children[this.currentPhotoIndex];
    if (currentBullet) {
      const progressBar = currentBullet.querySelector('.progress-bar');
      const remainingSeconds = remaining / 1000;
      progressBar.style.transition = `width ${remainingSeconds}s linear`;
      progressBar.style.width = '100%';
    }
  }

  setupResponsive() {
    this.isMobile = window.innerWidth <= 479;
  }

  openModal(eventId) {
    console.log('Opening modal for event ID:', eventId); // Для отладки
    console.log('Available stories:', this.stories.map(s => s.eventId)); // Для отладки
    
    // Найти соответствующую историю
    const storyIndex = this.stories.findIndex(story => story.eventId === eventId);
    console.log('Found story index:', storyIndex); // Для отладки
    
    if (storyIndex === -1) {
      console.error('Story not found for event ID:', eventId);
      return;
    }

    this.currentStoryIndex = storyIndex;
    this.currentPhotoIndex = 0;

    // Показать модальное окно
    this.modal.style.display = 'flex';
    
    // Настроить истории
    this.setupStories();
    this.updatePagination();
    this.updateNavigation();
    this.startAutoProgress();

    // Добавить анимацию появления
    setTimeout(() => {
      this.modal.style.opacity = '1';
    }, 10);
  }

  closeModal() {
    this.stopAutoProgress();
    this.modal.style.display = 'none';
    this.modal.style.opacity = '0';
    this.isPaused = false;
  }

  setupStories() {
    this.stories.forEach((story, index) => {
      const isActive = index === this.currentStoryIndex;
      const storyElement = story.element;
      
      if (this.isMobile) {
        // На мобильных: активная история на весь экран, остальные скрыты
        if (isActive) {
          storyElement.style.width = '100vw';
          storyElement.style.transform = 'translateX(0)';
          storyElement.style.opacity = '1';
          storyElement.style.zIndex = '10';
        } else {
          storyElement.style.opacity = '0';
          storyElement.style.transform = `translateX(${index < this.currentStoryIndex ? '-100vw' : '100vw'})`;
          storyElement.style.zIndex = '1';
        }
      } else {
        // На десктопе: все истории видны, активная выделена
        storyElement.style.opacity = '1';
        storyElement.style.transform = 'translateX(0)';
        storyElement.style.zIndex = isActive ? '10' : '5';
        
        // Добавляем обработчик клика для неактивных историй
        if (!isActive) {
          storyElement.style.cursor = 'pointer';
          storyElement.onclick = () => this.navigateToStory(index);
        } else {
          storyElement.style.cursor = 'default';
          storyElement.onclick = null;
        }
      }

      // Показать/скрыть overlay для неактивных историй
      const overlay = storyElement.querySelector('.stories-overlay');
      if (overlay) {
        overlay.style.display = isActive ? 'none' : 'block';
      }

      // Настроить фото внутри истории
      this.setupPhotosInStory(story, index === this.currentStoryIndex);
      
      // Анимация
      storyElement.style.transition = 'all 300ms ease';
    });
  }

  navigateToStory(storyIndex) {
    if (storyIndex < 0 || storyIndex >= this.stories.length) return;
    if (storyIndex === this.currentStoryIndex) return;

    this.stopAutoProgress();
    this.currentStoryIndex = storyIndex;
    this.currentPhotoIndex = 0;
    
    this.setupStories();
    this.updatePagination();
    this.updateNavigation();
    this.startAutoProgress();
  }

  setupPhotosInStory(story, isActive) {
    story.photos.forEach((photo, photoIndex) => {
      if (isActive) {
        photo.style.transform = `translateX(${(photoIndex - this.currentPhotoIndex) * 100}%)`;
        photo.style.opacity = photoIndex === this.currentPhotoIndex ? '1' : '0';
      } else {
        photo.style.transform = 'translateX(0)';
        photo.style.opacity = '1';
      }
      photo.style.transition = 'all 300ms ease';
    });
  }

  updatePagination() {
    const currentStory = this.stories[this.currentStoryIndex];
    if (!currentStory) return;

    // Очистить существующие буллеты
    this.pagination.innerHTML = '';

    // Создать буллеты для текущей истории
    currentStory.photos.forEach((photo, index) => {
      const bullet = document.createElement('div');
      bullet.className = 'pagination-bullet';
      bullet.style.cursor = 'pointer';
      
      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      
      bullet.appendChild(progressBar);
      this.pagination.appendChild(bullet);

      // Обработчик клика на буллет
      bullet.addEventListener('click', () => {
        this.stopAutoProgress();
        this.currentPhotoIndex = index;
        this.updateStoryPhoto();
        this.updatePagination();
        this.updateNavigation();
        this.startAutoProgress();
      });
    });

    this.updateProgressBars();
  }

  updateProgressBars() {
    const bullets = this.pagination.querySelectorAll('.pagination-bullet');
    bullets.forEach((bullet, index) => {
      const progressBar = bullet.querySelector('.progress-bar');
      if (index < this.currentPhotoIndex) {
        // Уже просмотренные фото - 100%
        progressBar.style.width = '100%';
        progressBar.style.transition = 'none';
      } else if (index === this.currentPhotoIndex) {
        // Текущее фото - анимация от 0 до 100%
        progressBar.style.width = '0%';
        progressBar.style.transition = 'width 5s linear';
        this.progressStartTime = Date.now();
        setTimeout(() => {
          if (!this.isPaused) {
            progressBar.style.width = '100%';
          }
        }, 10);
      } else {
        // Будущие фото - 0%
        progressBar.style.width = '0%';
        progressBar.style.transition = 'none';
      }
    });
  }

  updateStoryPhoto() {
    const currentStory = this.stories[this.currentStoryIndex];
    if (!currentStory) return;

    currentStory.photos.forEach((photo, photoIndex) => {
      photo.style.transform = `translateX(${(photoIndex - this.currentPhotoIndex) * 100}%)`;
      photo.style.opacity = photoIndex === this.currentPhotoIndex ? '1' : '0';
    });
  }

  updateNavigation() {
    const currentStory = this.stories[this.currentStoryIndex];
    const isFirstPhoto = this.currentPhotoIndex === 0;
    const isLastPhoto = this.currentPhotoIndex === currentStory.photos.length - 1;
    const isFirstStory = this.currentStoryIndex === 0;
    const isLastStory = this.currentStoryIndex === this.stories.length - 1;

    // Показать/скрыть кнопки
    if (isFirstPhoto && isFirstStory) {
      this.prevBtn.style.opacity = '0';
      this.prevBtn.style.pointerEvents = 'none';
    } else {
      this.prevBtn.style.opacity = '1';
      this.prevBtn.style.pointerEvents = 'auto';
    }
>>>>>>> 785b7cd25916d839f8d89c7138878ce9b743396b:script.js

    if (isLastPhoto && isLastStory) {
      this.nextBtn.style.opacity = '0';
      this.nextBtn.style.pointerEvents = 'none';
    } else {
      this.nextBtn.style.opacity = '1';
      this.nextBtn.style.pointerEvents = 'auto';
    }
  }

  navigateNext() {
    this.stopAutoProgress();
    
    const currentStory = this.stories[this.currentStoryIndex];
    const isLastPhoto = this.currentPhotoIndex === currentStory.photos.length - 1;
    
    if (isLastPhoto) {
      // Переход к следующей истории
      if (this.currentStoryIndex < this.stories.length - 1) {
        this.currentStoryIndex++;
        this.currentPhotoIndex = 0;
        this.setupStories();
        this.updatePagination();
      }
    } else {
      // Переход к следующему фото
      this.currentPhotoIndex++;
      this.updateStoryPhoto();
      this.updateProgressBars();
    }
    
    this.updateNavigation();
    this.startAutoProgress();
  }

  navigatePrev() {
    this.stopAutoProgress();
    
    const isFirstPhoto = this.currentPhotoIndex === 0;
    
    if (isFirstPhoto) {
      // Переход к предыдущей истории
      if (this.currentStoryIndex > 0) {
        this.currentStoryIndex--;
        const prevStory = this.stories[this.currentStoryIndex];
        this.currentPhotoIndex = prevStory.photos.length - 1;
        this.setupStories();
        this.updatePagination();
      }
    } else {
      // Переход к предыдущему фото
      this.currentPhotoIndex--;
      this.updateStoryPhoto();
      this.updateProgressBars();
    }
    
    this.updateNavigation();
    this.startAutoProgress();
  }

<<<<<<< HEAD:script.html
  btnClose.addEventListener('click', () => {
    clearTimeout(autoProgressTimeout);
    modal.style.display = 'none';
  });
});
</script>
=======
  startAutoProgress(customDuration = 5000) {
    this.stopAutoProgress();
    
    this.autoProgressTimer = setTimeout(() => {
      if (!this.isPaused) {
        this.navigateNext();
      }
    }, customDuration);
  }

  stopAutoProgress() {
    if (this.autoProgressTimer) {
      clearTimeout(this.autoProgressTimer);
      this.autoProgressTimer = null;
    }
  }
}

// Инициализация после загрузки DOM
document.addEventListener('DOMContentLoaded', () => {
  // Небольшая задержка для корректной инициализации Swiper
  setTimeout(() => {
    window.storiesModal = new StoriesModal();
  }, 100);
});

// Инициализация при изменении размера окна
window.addEventListener('resize', () => {
  if (window.storiesModal) {
    window.storiesModal.setupResponsive();
  }
});
>>>>>>> 785b7cd25916d839f8d89c7138878ce9b743396b:script.js
